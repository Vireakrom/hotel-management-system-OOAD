using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace HotelManagementSystem.Models
{
    /// <summary>
    /// Abstract base class for all room types
    /// Demonstrates inheritance and polymorphism in OOAD
    /// </summary>
    public abstract class Room
    {
        public int RoomId { get; set; }
        public string RoomNumber { get; set; }
        public string RoomType { get; set; }
        public string Status { get; set; }  // Available, Occupied, Reserved, Maintenance, Cleaning
        public decimal BasePrice { get; set; }
        public int FloorNumber { get; set; }
        public int MaxOccupancy { get; set; }
        public string BedType { get; set; }
        public decimal Area { get; set; }
        public string ViewType { get; set; }
        public bool HasBalcony { get; set; }
        public bool HasSeaView { get; set; }
        public bool HasJacuzzi { get; set; }
        public bool HasPrivatePool { get; set; }
        public string Amenities { get; set; }
        public string Description { get; set; }
        public DateTime CreatedDate { get; set; }
        public DateTime? ModifiedDate { get; set; }

        // Abstract methods - must be implemented by concrete classes
        public abstract decimal GetPrice();
        public abstract string GetDescription();

        /// <summary>
        /// Gets formatted room information for display
        /// </summary>
        public virtual string GetDetailedInfo()
        {
            return $"{RoomType} Room #{RoomNumber}\n" +
                   $"Floor: {FloorNumber}\n" +
                   $"Price: ${BasePrice}/night\n" +
                   $"Status: {Status}\n" +
                   $"Max Occupancy: {MaxOccupancy} guest(s)\n" +
                   $"Bed Type: {BedType}\n" +
                   $"Area: {Area} sq.m\n" +
                   $"View: {ViewType ?? "Standard"}";
        }

        /// <summary>
        /// Checks if the room is available for booking
        /// </summary>
        public virtual bool IsAvailable()
        {
            return Status == "Available" || Status == "Cleaning";
        }

        /// <summary>
        /// Checks if room can accommodate specified number of guests
        /// </summary>
        public virtual bool CanAccommodate(int numberOfGuests)
        {
            return numberOfGuests > 0 && numberOfGuests <= MaxOccupancy;
        }

        /// <summary>
        /// Calculates total price for given number of nights
        /// </summary>
        public virtual decimal CalculateTotalPrice(int numberOfNights)
        {
            if (numberOfNights <= 0)
                throw new ArgumentException("Number of nights must be positive", nameof(numberOfNights));
            
            return GetPrice() * numberOfNights;
        }

        /// <summary>
        /// Validates room data
        /// </summary>
        public virtual bool IsValid(out string errorMessage)
        {
            errorMessage = string.Empty;

            if (string.IsNullOrWhiteSpace(RoomNumber))
            {
                errorMessage = "Room number is required";
                return false;
            }

            if (BasePrice <= 0)
            {
                errorMessage = "Base price must be greater than zero";
                return false;
            }

            if (FloorNumber <= 0)
            {
                errorMessage = "Floor number must be positive";
                return false;
            }

            if (MaxOccupancy <= 0)
            {
                errorMessage = "Max occupancy must be positive";
                return false;
            }

            if (Area < 0)
            {
                errorMessage = "Area cannot be negative";
                return false;
            }

            return true;
        }

        /// <summary>
        /// Gets a summary of special features
        /// </summary>
        public virtual string GetFeaturesSummary()
        {
            List<string> features = new List<string>();
            
            if (HasBalcony) features.Add("Balcony");
            if (HasSeaView) features.Add("Sea View");
            if (HasJacuzzi) features.Add("Jacuzzi");
            if (HasPrivatePool) features.Add("Private Pool");
            
            return features.Count > 0 ? string.Join(", ", features) : "Standard Features";
        }

        public override string ToString()
        {
            return $"{RoomType} Room {RoomNumber} - {Status} - ${BasePrice}/night";
        }
    }

    /// <summary>
    /// Single Room - Budget-friendly option for solo travelers
    /// </summary>
    public class SingleRoom : Room
    {
        public SingleRoom()
        {
            RoomType = "Single";
            MaxOccupancy = 1;
            BedType = "Single";
        }

        public override decimal GetPrice()
        {
            // Single rooms have standard pricing
            return BasePrice;
        }

        public override string GetDescription()
        {
            return $"Single Room - {RoomNumber} (Floor {FloorNumber}) - Perfect for solo travelers";
        }

        public override string GetFeaturesSummary()
        {
            return "WiFi, TV, Air Conditioning, Phone";
        }
    }

    /// <summary>
    /// Double Room - Comfortable accommodation for couples or friends
    /// </summary>
    public class DoubleRoom : Room
    {
        public DoubleRoom()
        {
            RoomType = "Double";
            MaxOccupancy = 2;
            BedType = "Queen";
        }

        public override decimal GetPrice()
        {
            // Double rooms have standard pricing
            return BasePrice;
        }

        public override string GetDescription()
        {
            return $"Double Room - {RoomNumber} (Floor {FloorNumber}) - Comfortable for two guests";
        }

        public override string GetFeaturesSummary()
        {
            string baseFeatures = "WiFi, TV, Air Conditioning, Mini Bar, Safe, Phone";
            string extraFeatures = base.GetFeaturesSummary();
            return extraFeatures != "Standard Features" 
                ? $"{baseFeatures}, {extraFeatures}" 
                : baseFeatures;
        }
    }

    /// <summary>
    /// Suite Room - Luxury accommodation with separate living area
    /// </summary>
    public class SuiteRoom : Room
    {
        public SuiteRoom()
        {
            RoomType = "Suite";
            MaxOccupancy = 4;
            BedType = "King";
            HasBalcony = true;  // Suites always have balcony
        }

        public override decimal GetPrice()
        {
            // Suites can have premium pricing based on features
            decimal price = BasePrice;
            
            // Add premium for sea view
            if (HasSeaView)
                price += BasePrice * 0.15m;  // 15% premium
            
            return price;
        }

        public override string GetDescription()
        {
            return $"Suite Room - {RoomNumber} (Floor {FloorNumber}) - Luxury suite with separate living area";
        }

        public override string GetFeaturesSummary()
        {
            string baseFeatures = "WiFi, Smart TV, Air Conditioning, Mini Bar, Safe, Coffee Maker, Balcony, Phone";
            string extraFeatures = base.GetFeaturesSummary();
            
            if (extraFeatures != "Standard Features" && !extraFeatures.Contains("Balcony"))
                return $"{baseFeatures}, {extraFeatures}";
            
            return baseFeatures;
        }

        public override string GetDetailedInfo()
        {
            return base.GetDetailedInfo() + "\n? Luxury Suite - Separate living area included";
        }
    }

    /// <summary>
    /// Deluxe Room - Premium experience with exclusive amenities
    /// </summary>
    public class DeluxeRoom : Room
    {
        public DeluxeRoom()
        {
            RoomType = "Deluxe";
            MaxOccupancy = 4;
            BedType = "King";
            HasBalcony = true;  // Deluxe always has balcony
            HasJacuzzi = true;  // Deluxe always has jacuzzi
        }

        public override decimal GetPrice()
        {
            // Deluxe rooms have premium pricing
            decimal price = BasePrice;
            
            // Add premium for sea view
            if (HasSeaView)
                price += BasePrice * 0.20m;  // 20% premium
            
            // Add premium for private pool
            if (HasPrivatePool)
                price += BasePrice * 0.25m;  // 25% premium
            
            return price;
        }

        public override string GetDescription()
        {
            return $"Deluxe Room - {RoomNumber} (Floor {FloorNumber}) - Premium experience with exclusive amenities";
        }

        public override string GetFeaturesSummary()
        {
            string baseFeatures = "WiFi, Smart TV, Air Conditioning, Mini Bar, Safe, Coffee Maker, Balcony, Jacuzzi, Phone";
            string extraFeatures = base.GetFeaturesSummary();
            
            // Remove duplicate features
            List<string> allFeatures = new List<string>();
            allFeatures.AddRange(baseFeatures.Split(new[] { ", " }, StringSplitOptions.None));
            
            if (extraFeatures != "Standard Features")
            {
                foreach (string feature in extraFeatures.Split(new[] { ", " }, StringSplitOptions.None))
                {
                    if (!allFeatures.Contains(feature))
                        allFeatures.Add(feature);
                }
            }
            
            return string.Join(", ", allFeatures);
        }

        public override string GetDetailedInfo()
        {
            return base.GetDetailedInfo() + "\n? Premium Deluxe - VIP treatment included";
        }
    }
}
